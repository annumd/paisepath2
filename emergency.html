<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Fund Tracking</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f7fa;
            margin: 0;
        }
        header {
            background: #e53935;
            color: white;
            text-align: center;
            padding: 20px 0;
            font-size: 2em;
        }
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
        }
        .btn {
            background: #e53935;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .btn:hover { background: #c62828; }
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        h3 { color: #333; margin-top: 0; }
        input, select {
            width: 100%;
            padding: 8px;
            margin-top: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            margin-top: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            text-align: center;
        }
        th {
            background: #e53935;
            color: white;
        }
        .status {
            font-weight: bold;
            color: #388e3c;
        }
    </style>
</head>
<body>

<header>Emergency Fund Tracking</header>

<div class="container">
    <button class="btn" onclick="location.href='features.html'">Back to Features</button>

    <div class="card">
        <h3>Request Emergency Funds</h3>
        <label for="user">Your Name:</label>
        <input type="text" id="user" placeholder="Enter your name">

        <label for="amount">Amount Requested (₹):</label>
        <input type="number" id="amount" placeholder="Enter amount">

        <label for="reason">Reason for Request:</label>
        <input type="text" id="reason" placeholder="e.g., Medical, Education, etc.">

        <button class="btn" onclick="submitRequest()">Submit Request</button>
    </div>

    <h3>Fund Requests Overview</h3>
    <table id="fundTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Amount (₹)</th>
                <th>Reason</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="fundBody">
            <tr>
                <td>Riya</td>
                <td>3000</td>
                <td>Medical Expense</td>
                <td class="status">Approved</td>
            </tr>
            <tr>
                <td>Arjun</td>
                <td>2000</td>
                <td>Education Fee</td>
                <td class="status">Pending</td>
            </tr>
        </tbody>
    </table>
</div>

<script>
const user_id = 1; // optional, if you want to track user

function submitRequest() {
    const name = document.getElementById("user").value.trim();
    const amount = document.getElementById("amount").value.trim();
    const reason = document.getElementById("reason").value.trim();

    if (!name || !amount || !reason) {
        alert("Please fill all fields!");
        return;
    }

    // 1️⃣ Send POST request to backend
    fetch("http://localhost:5000/emergency", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ user_name: name, amount, reason })
    })
    .then(res => res.json())
    .then(response => {
        console.log("Server response:", response);
        // 2️⃣ Refresh the table from backend
        loadEmergencyRequests();
        // 3️⃣ Clear inputs
        document.getElementById("user").value = "";
        document.getElementById("amount").value = "";
        document.getElementById("reason").value = "";
    })
    .catch(err => {
        console.error("Error:", err);
        alert("Failed to submit request. Check console.");
    });
}

// Function to fetch all emergency requests from backend
function loadEmergencyRequests() {
    fetch("http://localhost:5000/emergency")
    .then(res => res.json())
    .then(data => {
        const tableBody = document.getElementById("fundBody");
        tableBody.innerHTML = ""; // clear old rows
        data.forEach(row => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${row.user_name}</td>
                <td>${row.amount}</td>
                <td>${row.reason}</td>
                <td class="status">Pending</td>
            `;
            tableBody.appendChild(tr);
        });
    })
    .catch(err => console.error("Error loading data:", err));
}

// Load requests automatically when page loads
window.onload = loadEmergencyRequests;
</script>


</body>
</html>
